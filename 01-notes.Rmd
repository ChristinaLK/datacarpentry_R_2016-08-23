---
layout: topic
title: Intro to R (notes)
author: Data Carpentry contributors
minutes: 45
---

```{r, echo=FALSE}
knitr::opts_chunk$set(results='hide', fig.path='img/r-lesson-')
```

## R and RStudio

### R

- Free and open source general statistical programming language
- Broad statistical and graphics functions
- Huge community of add-on packages
- Not just for statistics, but also general purpose programming.

### RStudio

- Integrated Development Environment (IDE) for R
- Separate program, developed by a company but also free and open
  source.
- By far the best thing to use when learning R.

### RStudio orientation

Four panes (can be re-organized, but always these four panes)

- Scripts (top-left)
- R console (bottom-left)
- Environment/history (top-right)
- Files/plots/help/etc (bottom-right)

## R as a calculator

- `Ctrl-Shift-2` to focus only on the R console.
- `Ctrl-Shift-0` to get back.

- Explain `>` prompt and do some calculations

```{r add, results="markup"}
2016 - 1969
```

```{r calculations, eval=FALSE}
4*6
4/6
4^6
log(4)
log10(4)
log(4, 10)
log(4, 6)
```

- Explain that `log` is a function with two arguments.

## Getting help

- Pause for a moment after typing `log`
- Type `?log`

## Need for scripts

- Want to save what we're doing
- Really want to organize the scripts and data for a project

### Create a new R project

- File → New Project → New directory → Empty project
- Give it a name, like `~/data-carpentry`
- Under files tab on the bottom right, click "New Folder" and create a
  folder named `data`

### Create an R script

- File → New File → R script
- Save it in the current working directory, `data-carpentry-script.R`

## Typing into the script and pasting to console

- Type some stuff into the script

```{r rscript}
# R intro

2016 - 1969
```

- Paste to console with <kbd>`Ctrl`</kbd> + <kbd>`Enter`</kbd>

- Explain comment sign, `#`


## Assigment operator

```{r assign}
age <- 2016 - 1969
```

- Paste into console.
- Can also use `=`, but recommend `<-`.
- Can use <kbd>Alt</kbd> + <kbd>-</kbd>

### Using the stuff you assigned

```{r sqrt}
sqrt(age)
```

```{r more_assign}
sqrt_age <- sqrt(age)
round(sqrt_age)
round(sqrt_age, 2)
```

### Object names

- explicit but not too long
- can't start with a number
- there are some names not allowed (`if`, `for`, `else`)
- other names you can but shouldn't use (`c`, `data`, `mean`)
- Can use `.`, but best not to

### Challenge

What is the value of `y` after doing the following?

```{r}
x <- 50
y <- x * 2
x <- 80
```

### Objects in workspace

- `ls()`
- Environment panel

## Vectors and data types

```{r vectors}
weights <- c(30, 100, 4000, 8000)
animals <- c("rat", "cat")
```

### length, class, str

```{r length}
length(weights)
length(animals)
```

```{r class_str}
class(weights)
class(animals)
str(weights)
str(animals)
```

### Add to a vector

```{r}
animals <- c(animals, "dog") # adding at the end of the vector
animals <- c("mouse", animals) # adding at the beginning of the vector
```


### Challenge

What happens to vectors with mixed types?
(Hint: use `class()`)

```{r, echo=TRUE, eval=FALSE}
x <- c(1, 2, 3, 'a')

y <- c(1, 2, 3, TRUE)

z <- c('a', 'b', 'c', TRUE)

tricky <- c(1, 2, 3, '4')
```

## Subsetting vectors

```{r, subset1}
animals <- c("mouse", "rat", "dog", "cat")
animals[2]
animals[c(1, 4)]
```

```{r, results='show'}
more_animals <- animals[c(1, 2, 3, 2, 1, 4)]
```

### Challenge

Consider the `animals` vector.

```{r eval=FALSE}
animals <- c("mouse", "rat", "dog", "cat")
```

Subset to get the 2nd and 3rd values.


### Conditional subsetting

Subsetting with a logical vector.

```{r, results='show'}
x <- c(21, 54, 39, 17, 55)
x[c(FALSE, TRUE, FALSE, FALSE, TRUE)]
```

Creating a logical vector.

```{r, results='show'}
x > 50    # will return logicals with TRUE for the indices that meet the condition
## so we can use this to select only the values above 50
x[x>50]
```

Using `&` and `|`.

```{r, results='show'}
x[x < 30 | x > 50]
x[x > 30 & x < 50]
```

Using `%in%` with character strings.

```{r, results='show'}
animals <- c("mouse", "rat", "dog", "cat")
animals[animals == "cat" | animals == "rat"] # returns both rat and cat
animals %in% c("rat", "cat", "dog", "duck")
animals[animals %in% c("rat", "cat", "dog", "duck")]
```

### Challenge

Consider the following two vectors.

```{r, eval=FALSE}
animals <- c("mouse", "rat", "cat", "dog")
weights <- c(30, 180, 4000, 8000)
```

Subset `animals` with `weights < 200`.


## Missing data

```{r}
heights <- c(2, 4, 4, NA, 6)
```

```{r}
mean(heights)
max(heights)
mean(heights, na.rm = TRUE)
max(heights, na.rm = TRUE)
```

```{r}
## Extract those elements which are not missing values.
heights[!is.na(heights)]
## shortcut to that
na.omit(heights)
```

### Challenge

Why does the following give an error?

```{r mean_na, eval=FALSE}
v <- c(2, 4, 4, "NA", 6)
mean(v, na.rm=TRUE)
```

Why does the error message say the data are not numeric?


## Load the data

We first download the file:

```{r, eval=FALSE}
download.file("http://kbroman.org/datacarp/portal_data_joined.csv",
              "data/portal_data_joined.csv")
```

We then load them into R:

```{r, eval=TRUE}
surveys <- read.csv('data/portal_data_joined.csv')
```

Can also do:

```{r eval=FALSE}
surveys <- read.csv("http://kbroman.org/datacarp/portal_data_joined.csv")
```

Use `head()` to view the first few rows.

```{r head}
head(surveys)
```

Use `tail()` to view the last few rows.


```{r tail}
tail(surveys)
```

Use `str()` to look at the structure of the data.

```{r str}
str(surveys)
```

### Challenge

Based on the output of `str(surveys)`, can you answer the following questions?

* What is the class of the object `surveys`?
* How many rows and how many columns are in this object?
* How many species have been recorded during these surveys?


## Factors

Factors are categorical variables. They look like a vector of
character strings, but they're stored as integers with character
string labels for the distinct values, called _levels_.

Use `factor()` to create a vector that is a factor.

```{r}
sex <- factor(c("male", "female", "female", "male"))
```

Use `levels()` and `nlevels()` to see the levels and their number.

```{r}
levels(sex)
nlevels(sex)
```

If you provide the `levels` argument to `factor()`, you'll get the
levels in a particular order.

```{r}
food <- factor(c("low", "high", "medium", "high", "low", "medium", "high"))
levels(food)
food <- factor(food, levels=c("low", "medium", "high"))
levels(food)
```

Converting factors to numeric.

```{r}
f <- factor(c(1, 5, 10, 2))
as.numeric(f)               ## wrong! and there is no warning...
as.numeric(as.character(f)) ## works...
```

### Challenge

The function `table()` tabulates observations.

```
expt <- c("treat1", "treat2", "treat1", "treat3", "treat1", "control",
          "treat1", "treat2", "treat3")
expt <- factor(expt)
table(expt)
```

* In which order are the treatments listed?
* How can you recreate this table with "control" listed last instead
of first?


## stringsAsFactors

Avoid factors with `stringsAsFactors=FALSE`.

```{r}
surveys_chr <- read.csv("data/portal_data_joined.csv", stringsAsFactors=FALSE)
```

```{r}
str(surveys_chr)
```


### Constructing data frames "by hand"

```{r}
df1 <- data.frame(animal=c("dog", "cat", "sea cucumber", "sea urchin"),
                  feel=c("furry", "furry", "squishy", "spiny"),
                  weight=c(45, 8, 1.1, 0.8))
str(df1)

df2 <- data.frame(animal=c("dog", "cat", "sea cucumber", "sea urchin"),
                  feel=c("furry", "furry", "squishy", "spiny"),
                  weight=c(45, 8, 1.1, 0.8), stringsAsFactors=FALSE)
str(df2)
```


### Challenge

There are a few mistakes in this hand crafted `data.frame`, can you spot and
fix them? Don't hesitate to experiment!

```{r, eval=FALSE}
author_book <- data.frame(author_first=c("Charles", "Ernst", "Theodosius"),
                          author_last=c(Darwin, Mayr, Dobzhansky),
                          year=c(1942, 1970))
```


## Inspecting data frames

```{r}
dim(surveys)
nrow(surveys)
ncol(surveys)

names(surveys)
rownames(surveys)

summary(surveys)
```

## Indexing, sequences, subsetting

```{r}
surveys[1,1]

surveys[2,7]

surveys[2,]

sex <- surveys[,7]
```

Referring to columns.

```{r, eval = FALSE}
sex <- surveys[, "sex"]
sex <- surveys[["sex"]]
sex <- surveys$sex
```


### Treating blanks as missing

Mention use of `"NA"` as the standard missing value code, and that
this can be a problem if that's a valid value.

Also that blanks in numeric columns got converted to `NA`, but blanks
in the `sex` column were left as `""`.

```{r}
surveys_noblanks <- read.csv("data/portal_data_joined.csv", na.strings="")
```

### Slices

As with vectors, you can also use logical vectors when indexing.

```{r}
weights_males <- surveys[surveys$sex == 'M', "weight"]
mean(weights_males, na.rm=TRUE)

mean(surveys[surveys$sex == 'F', "weight"], na.rm=TRUE)
```

Or you can use numeric vectors. To pull out larger slices, it's
helpful to have ways of creating sequences of numbers.

First, `:`


```{r}
1:10
10:1
5:8
```

`seq` is more flexible.

```{r}
seq(1, 10, by=2)
seq(5, 10, length.out=3)
seq(50, by=5, length.out=10)
seq(1, 8, by=3) # sequence stops to stay below upper limit
seq(10, 2, by=-2)  # can also go backwards
```

Use these to take slices of the data.

```{r}
surveys[1:3, 7]   # first three elements in the 7th column
surveys[1, 1:3]   # first three columns in the first row
surveys[2:4, 6:7] # rows 2-4, columns 6-7
```

### Challenge

1. The function `nrow()` on a `data.frame` returns the number of rows. Use it,
   in conjuction with `seq()` to create a new `data.frame` called
   `surveys_by_10` that includes every 10th row of the survey data frame
   starting at row 10 (10, 20, 30, ...)

2. Create a `data.frame` containing only the observations from the
   year 1999 of the `surveys` dataset.



<br/> <br/> <br/> <br/> <br/> <br/> <br/> <br/> <br/> <br/>
